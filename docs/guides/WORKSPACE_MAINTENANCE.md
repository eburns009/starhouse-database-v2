# Workspace Maintenance Guide - FAANG Quality
**Codespace Optimization & Performance**

Date: 2025-11-15
Status: Production Standard

---

## Overview

This guide ensures optimal Codespace performance and prevents VS Code/Claude restart issues through proper workspace maintenance and configuration.

---

## Quick Start

### Weekly Cleanup (Recommended)
```bash
# Dry-run first to see what will be removed
./scripts/cleanup_workspace.sh --dry-run

# Run actual cleanup
./scripts/cleanup_workspace.sh
```

### Before Committing Large Changes
```bash
# Clean workspace
./scripts/cleanup_workspace.sh

# Check what's changed
git status

# Commit
git add .
git commit -m "your message"
```

---

## Common Issues & Solutions

### Issue 1: "Claude for VS Code wants to restart"
**Cause:** Too many files being watched (file watcher overload)

**Solution:**
```bash
./scripts/cleanup_workspace.sh
```

**Prevention:**
- Run cleanup weekly
- Don't let 100+ changed files accumulate
- Commit frequently

### Issue 2: "Bash error - git needs to restart"
**Cause:** Git tracking too many temporary files

**Solution:**
```bash
# Clean temp files
./scripts/cleanup_workspace.sh

# Update .gitignore (already done)
git add .gitignore
git commit -m "chore: update .gitignore for better performance"
```

**Prevention:**
- Temporary CSV files auto-ignored
- Log files auto-ignored
- Build artifacts auto-ignored

### Issue 3: Slow Codespace Performance
**Cause:** Large directories being indexed

**Solution:**
```bash
# Check workspace size
du -sh /workspaces/starhouse-database-v2

# Clean large directories
./scripts/cleanup_workspace.sh

# Check after
du -sh /workspaces/starhouse-database-v2
```

**Target:** < 1GB workspace size

---

## Automated Cleanup Script

### What It Cleans

1. **Python Cache** (`__pycache__/`)
   - Generated by Python imports
   - Safe to delete (regenerates)
   - Can have 100+ directories

2. **Next.js Build** (`starhouse-ui/.next/`)
   - 150-200MB of build artifacts
   - Regenerates on `npm run dev`
   - Safe to delete

3. **Log Files** (logs/*.log older than 7 days)
   - Keeps recent logs for debugging
   - Removes old logs to save space

4. **Temporary Files**
   - CSV exports in root directory
   - Temp analysis files
   - /tmp/ncoa_*.log files

5. **TypeScript Build Info** (*.tsbuildinfo)
   - TypeScript compilation cache
   - Regenerates on build

### Script Usage

```bash
# See what would be deleted (safe)
./scripts/cleanup_workspace.sh --dry-run

# Actual cleanup
./scripts/cleanup_workspace.sh

# View cleanup log
cat logs/cleanup_YYYYMMDD_HHMMSS.log
```

### Script Output Example

```
Before Cleanup:
  Python cache dirs:    105
  Next.js build:        157M
  Log files:            43 files (1.5M)
  Temp CSV files:       16
  Git changed files:    189
  Total workspace:      816M

After Cleanup:
  Python cache dirs:    0 (was 105)
  Next.js build:        0 (was 157M)
  Log files:            5 files (was 43)
  Temp CSV files:       5 (was 16)
  Git changed files:    12 (was 189)
  Total workspace:      659M (was 816M)

ðŸ’¾ Space Saved: 157M
```

---

## VS Code Configuration

### File Watcher Exclusions

The `.vscode/settings.json` excludes these directories from file watching:

- `node_modules/` - 658MB (thousands of files)
- `.next/` - Next.js builds (150MB+)
- `logs/` - Log files (changes frequently)
- `__pycache__/` - Python cache
- `.venv/` - Python virtual environment
- `dist/`, `build/` - Build artifacts

**Why:** Watching these directories causes performance issues and restart prompts.

### Search Exclusions

Same directories excluded from VS Code search to improve search speed.

---

## Git Configuration

### What's Ignored (.gitignore)

```gitignore
# Build artifacts
node_modules/
.next/
dist/
build/

# Caches
__pycache__/
.pytest_cache/
.ruff_cache/

# Logs
logs/
*.log

# Temporary files
*.csv (in root)
*.tmp
*.temp
/tmp/

# Database backups
contacts_backup_*.sql
```

### Why These Are Ignored

1. **Performance** - Don't track thousands of generated files
2. **Security** - Don't commit sensitive data (CSVs with PII)
3. **Size** - Don't bloat repository
4. **Clean History** - Only track source code, not artifacts

---

## Maintenance Schedule

### Daily (Automated by VS Code)
- âœ… File watcher excludes large directories
- âœ… Search excludes configured
- âœ… Git ignores temporary files

### Weekly (Manual - 2 minutes)
```bash
./scripts/cleanup_workspace.sh
```

Benefits:
- Remove accumulated cache
- Clean old logs
- Free disk space
- Prevent restart prompts

### Monthly (Manual - 5 minutes)
```bash
# Full workspace audit
./scripts/cleanup_workspace.sh

# Check git status
git status

# Commit pending changes
git add .
git commit -m "chore: monthly cleanup"

# Optional: Rebuild Codespace (if needed)
# Creates fresh environment
```

### As Needed
```bash
# Before large imports
./scripts/cleanup_workspace.sh

# After multiple builds
rm -rf starhouse-ui/.next

# If performance degrades
./scripts/cleanup_workspace.sh
```

---

## Performance Metrics

### Target Metrics (Good)
- Workspace size: < 1GB
- Changed files: < 20
- Python cache dirs: 0
- Log files: < 10
- Git status time: < 1 second

### Warning Signs (Needs Cleanup)
- Workspace size: > 1.5GB
- Changed files: > 50
- Python cache dirs: > 50
- Log files: > 30
- Git status time: > 3 seconds

### Critical (Clean Immediately)
- Workspace size: > 2GB
- Changed files: > 100
- Python cache dirs: > 100
- Log files: > 50
- VS Code restart prompts

---

## Troubleshooting

### Cleanup Script Fails

**Error:** "Permission denied"
```bash
chmod +x scripts/cleanup_workspace.sh
./scripts/cleanup_workspace.sh
```

**Error:** "No such file or directory"
```bash
# Run from workspace root
cd /workspaces/starhouse-database-v2
./scripts/cleanup_workspace.sh
```

### VS Code Still Prompts for Restart

1. Run cleanup script
2. Commit all changes
3. Reload VS Code window: `Ctrl+Shift+P` â†’ "Reload Window"
4. If persists, rebuild Codespace (nuclear option)

### Git is Slow

```bash
# Check what's being tracked
git status --porcelain | wc -l

# Should be < 20 files
# If > 100, run cleanup:
./scripts/cleanup_workspace.sh
```

### Disk Space Full

```bash
# Check disk usage
df -h

# Find largest directories
du -sh /workspaces/starhouse-database-v2/* | sort -rh | head -20

# Clean workspace
./scripts/cleanup_workspace.sh

# If still full, check node_modules
du -sh starhouse-ui/node_modules
```

---

## Best Practices

### âœ… DO

- Run cleanup weekly
- Commit changes frequently (< 20 files)
- Use cleanup script before large operations
- Check git status before committing
- Keep workspace < 1GB
- Delete temporary CSV files when done
- Let .gitignore work (don't force-add ignored files)

### âŒ DON'T

- Let 100+ files accumulate
- Commit build artifacts (node_modules, .next)
- Track log files in git
- Keep old CSV exports in root
- Force-add files that should be ignored
- Run builds without cleaning first
- Skip cleanup for weeks

---

## FAANG Quality Checklist

### Configuration as Code âœ…
- [x] `.gitignore` properly configured
- [x] `.vscode/settings.json` optimized
- [x] Cleanup script automated
- [x] Documentation complete

### Automation âœ…
- [x] One-command cleanup
- [x] Dry-run mode for safety
- [x] Metrics before/after
- [x] Idempotent (safe to run multiple times)

### Monitoring âœ…
- [x] Script shows metrics
- [x] Logs all operations
- [x] Reports space saved
- [x] Tracks file counts

### Safety âœ…
- [x] Dry-run mode available
- [x] Logs what was deleted
- [x] No destructive git operations
- [x] Safe to run anytime

### Documentation âœ…
- [x] Usage guide (this document)
- [x] Maintenance schedule
- [x] Troubleshooting steps
- [x] Best practices

---

## Quick Reference

### One-Liner Commands

```bash
# Weekly cleanup
./scripts/cleanup_workspace.sh

# Check workspace size
du -sh .

# Count changed files
git status --porcelain | wc -l

# Find large files
find . -type f -size +10M 2>/dev/null

# Clean Python cache manually
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null

# Clean Next.js build manually
rm -rf starhouse-ui/.next

# View recent logs only
ls -lhrt logs/ | tail -10
```

### File Locations

- **Cleanup script:** `scripts/cleanup_workspace.sh`
- **VS Code settings:** `.vscode/settings.json`
- **Git ignore:** `.gitignore`
- **Cleanup logs:** `logs/cleanup_*.log`
- **This guide:** `docs/guides/WORKSPACE_MAINTENANCE.md`

---

## Summary

**Running the cleanup script weekly prevents:**
- VS Code restart prompts
- Claude for VS Code restart errors
- Slow git operations
- File watcher overload
- Disk space issues

**Time investment:** 2 minutes/week
**Benefit:** Smooth, fast development experience

**Remember:** An optimized workspace is a happy workspace! ðŸš€

---

**Last Updated:** 2025-11-15
**Maintained by:** StarHouse CRM Team
**FAANG Quality:** âœ… Verified
